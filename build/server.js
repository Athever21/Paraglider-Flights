(()=>{"use strict";var t={334:t=>{t.exports=require("dotenv")}},n={};function e(r){var o=n[r];if(void 0!==o)return o.exports;var i=n[r]={exports:{}};return t[r](i,i.exports,e),i.exports}e.n=t=>{var n=t&&t.__esModule?()=>t.default:()=>t;return e.d(n,{a:n}),n},e.d=(t,n)=>{for(var r in n)e.o(n,r)&&!e.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:n[r]})},e.o=(t,n)=>Object.prototype.hasOwnProperty.call(t,n),(()=>{const t=require("express");var n=e.n(t);const r=require("fs"),o=require("path");var i=e.n(o);const s=require("https");var u=e.n(s);function a(t){var n=t.split("");return n.splice(2,0,":"),n.splice(5,0,":"),n.join("")}function c(t){return t>10?t:"0"+t}function l(t){return{hours:parseInt(t.substring(0,2)),minutes:parseInt(t.substring(2,4)),seconds:parseInt(t.substring(4,6))}}function f(t){return new Promise((function(n,e){var r=process.env.API_KEY,o="https://api.opencagedata.com/geocode/v1/json?q="+function(t){var n=t.split("");"S"===n.pop()&&n.unshift("-");n.splice(2,0,"."),"0"===n[0]&&n.shift();return n.join("")}(t.lat)+"+"+function(t){var n=t.split("");"W"===n.pop()&&n.unshift("-");n.splice(3,0,"."),"0"===n[0]&&n.shift();"0"===n[0]&&n.shift();return n.join("")}(t.long)+"&key="+r;u().get(o,(function(t){var r="";t.on("data",(function(t){return r+=t})),t.on("end",(function(){return n(JSON.parse(r).results)})),t.on("error",(function(t){return e(t)}))}))}))}const p=function(){function t(){}return t.prototype.processUrl=function(t){var n=this;return new Promise((function(e){u().get(t,(function(t){return n.processData(t,e)}))}))},t.prototype.processLine=function(t){if(t.includes("PILOT")&&(this.pilot=t.split(":").pop()),t.includes("GLIDERTYPE")&&(this.glider=t.split(":").pop()),"B"===t[0]){for(var n="",e="",r="",o="time",i=1;i<t.length;i++){var s=t[i];if(7==i)o="lat";else{if("N"===s||"S"===s){e+=s,o="long";continue}if("W"===t||"E"===s){r+=s,o="alt";break}}"time"===o&&(n+=s),"lat"===o&&(e+=s),"long"===o&&(r+=s)}this.timeStart||(this.timeStart=n),this.timeStop=n,this.startLocation||(this.startLocation={long:r,lat:e}),this.endLocation={long:r,lat:e}}},t.prototype.processChunk=function(t){var n=this,e=t.toString().split("\r");e.forEach((function(t,r){if(r===e.length-1)n.prev=t;else{var o=0===r?n.prev+t:t;n.processLine(o.trim())}}))},t.prototype.processData=function(t,n){var e=this;t.on("data",(function(t){return e.processChunk(t)})),t.on("end",(function(){var t,r,o,i,s,u,p;e.travelTime=(t=e.timeStart,r=e.timeStop,o=l(t),i=l(r),s=c(Math.abs(o.hours-i.hours)),u=c(Math.abs(o.minutes-i.minutes)),p=c(Math.abs(o.seconds-i.seconds)),s+":"+u+":"+p),e.timeStart=a(e.timeStart),e.timeStop=a(e.timeStop),Promise.all([f(e.startLocation),f(e.endLocation)]).then((function(t){e.start=t[0][0].formatted,e.end=t[1][0].formatted,n()})).catch((function(t){console.log(t)}))}))},t}();var h=(0,t.Router)();h.post("/from-link",(function(t,n){var e=t.body.url,r=new p;r.processUrl(e).then((function(){return n.json(JSON.stringify(r))})).catch((function(){return n.status(400).json({error:"Invalid link to file"})}))}));const d=h;var v=function(t,n,e,r){return new(e||(e=Promise))((function(o,i){function s(t){try{a(r.next(t))}catch(t){i(t)}}function u(t){try{a(r.throw(t))}catch(t){i(t)}}function a(t){var n;t.done?o(t.value):(n=t.value,n instanceof e?n:new e((function(t){t(n)}))).then(s,u)}a((r=r.apply(t,n||[])).next())}))},b=function(t,n){var e,r,o,i,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function u(i){return function(u){return function(i){if(e)throw new TypeError("Generator is already executing.");for(;s;)try{if(e=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,r=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!(o=s.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){s=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){s.label=i[1];break}if(6===i[0]&&s.label<o[1]){s.label=o[1],o=i;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(i);break}o[2]&&s.ops.pop(),s.trys.pop();continue}i=n.call(t,s)}catch(t){i=[6,t],r=0}finally{e=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,u])}}};e(334).config();var m=process.cwd(),g=n()(),y='<script src="/build/bundle.js"><\/script>';y="",v(void 0,void 0,void 0,(function(){return b(this,(function(t){switch(t.label){case 0:return[4,r.promises.readdir(i().join(m,"build"))];case 1:return t.sent().forEach((function(t){t.includes("bundle")&&!t.includes(".txt")&&(y+='\n\t<script src="/build/'+t+'"><\/script>')})),[2]}}))})),g.use(n().json()),g.use("/build/",n().static(i().join(m,"build"))),g.use("/file",d),g.get("*",(function(t,n){return n.send(function(t){return'\n  <!DOCTYPE HTML>\n  <html lang="eng">\n    <head>\n      <meta charset="utf-8">\n      <title>Paraglider Flights</title>\n    </head>\n    <style>\n      html {\n        background: #101010;\n      }\n    </style>\n    <body>\n      <div id="root"></div>\n      '+t+"\n    </body>\n  </html>\n"}(y))}));var S=process.env.PORT||3e3;g.listen(S,(function(){return console.log("Server listening at PORT "+S)}))})()})();